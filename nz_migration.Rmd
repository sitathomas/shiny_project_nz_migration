---
title: "Shiny Project: NZ Migration"
author: "Sita Thomas"
date: "4/27/2020"
output: html_document
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)
library(scales)

```


## Data Information

Data can be downloaded at: http://archive.stats.govt.nz/infoshare/  
Subject Categories > Tourism > International Travel and Migration

```{r preprocessing, include=F}

major_occup <- read_csv("data/major_occupations.csv", col_names = T, skip = 3)
major_occup <- major_occup[-(9:44),]
colnames(major_occup)[1] = "year"
colnames(major_occup) <- gsub("and", "", colnames(major_occup))
colnames(major_occup) <- gsub(" ", "_", colnames(major_occup))
colnames(major_occup) <- tolower(colnames(major_occup))
colnames(major_occup)[13] = "total_occupations"

arrivals_by_gender <-
	read_csv("data/arrivals_by_gender.csv",
		col_names = T,
		skip = 4)
arrivals_by_gender <- arrivals_by_gender[-(9:41), ]
colnames(arrivals_by_gender)[1] = "year"
females <- arrivals_by_gender %>%
	pivot_longer(., 2:7, names_to = "visa_type", values_to = "females") %>%
	select(., year, visa_type, females)
males <- arrivals_by_gender %>%
	pivot_longer(., 8:13, names_to = "visa_type", values_to = "males") %>%
	select(., year, visa_type, males) %>%
	mutate(., visa_type = gsub("_1", "", visa_type))
arrivals_by_gender <- inner_join(females, males, by = c("year", "visa_type"))

```

## Exploring Net Permanent and Long-Term Migration by Year

```{r by_year, echo = F}

major_occup %>% 
	group_by(year) %>% 
	summarise(., total = sum(total_occupations)) %>% 
	ggplot(., aes(x = year, y = total)) +
		geom_col(fill = "sienna3") +
		labs(
			title = "Net Permanent and Long-Term Migration to New Zealand by Year",
			subtitle = "ANZSCO Major Occupations, 2010 - 2017",
			x = "Year", y = "All Major ANZSCO Occupations") +
		theme_few()

```


#### Conclusion: Exploring Net Permanent and Long-Term Migration by Year
- Although fairly level in 2016 and 2017, permanent and long-term migration to New Zealand for workers in the ANZSCO Major Occupation groups has increased throughout the 2010s.

## Exploring Net Migration by Occupation

```{r by_occupation, echo = F}

major_occup %>% 
	pivot_longer(.,
		cols = managers:labourers,
		names_to = "occupation",
		values_to = "occupation_count"
	) %>% 
	group_by(., occupation) %>% 
	summarise(., occupation_sum = sum(occupation_count)) %>% 
	ggplot(data = ., aes(y = occupation, x = occupation_sum)) +
		geom_col(fill = "sienna3") +
		labs(
			title = "Net Permanent and Long-Term Migration to New Zealand by Occupation",
			subtitle = "ANZSCO Major Occupations, 2010 - 2017",
			y = "Occupation", x = "All Major ANZSCO Occupations"
			) +
		theme_few() +
		scale_y_discrete(
			labels = c(
				"technicians__trades_workers" = "Technicians and Trades Workers",
				"sales_workers" = "Sales Workers",
				"professionals" = "Professionals",
				"managers" = "Managers",
				"machinery_operators__drivers" = "Machinery Operators and Drivers",
				"labourers" = "Laborers",
				"community__personal_service_workers" = "Community and Personal Service Workers",
				"clerical__administrative_workers" = "Clerical and Administrative Workers"
			)
		)

```


#### Conclusion: Exploring Net Permanent and Long-Term Migration by Occupation
- Most permanent and long-term migrants are Professionals by far, while more Sales Workers and Machinery Operators and Drivers have departed New Zealand than have arrived.
