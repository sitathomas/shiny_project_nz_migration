---
title: "Shiny Project: NZ Migration"
author: "Sita Thomas"
date: "4/27/2020"
output: html_document
---

```{r setup, include=F}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(ggthemes)
library(scales)

```


## Data Information

Data can be downloaded at: http://archive.stats.govt.nz/infoshare/  
Subject Categories > Tourism > International Travel and Migration

```{r preprocessing, include=F}

raw <- read_csv("data/ITM359302_20200428_125710_33.csv", col_names = T, skip = 3)

colnames(raw)[1] = "year"
	
data <- 
	separate(raw, year, c("year", "quarter"), sep = "Q") %>% 
	.[-c(33:68),]

colnames(data) <-	gsub("and", "", colnames(data))
colnames(data) <-	gsub(" ", "_", colnames(data))
colnames(data) <- tolower(colnames(data))
colnames(data)[14] <- "total_occupations"
	
```

## Exploring Net Permanent and Long-Term Migration by Year

```{r by_year, echo = F}

data %>% 
	group_by(year) %>% 
	summarise(., total = sum(total_occupations)) %>% 
	ggplot(., aes(x = year, y = total)) +
		geom_col(fill = "sienna3") +
		labs(
			title = "Net Permanent and Long-Term Migration to New Zealand by Year",
			subtitle = "ANZSCO Major Occupations, 2010 - 2017",
			x = "Year", y = "All Major ANZSCO Occupations") +
		theme_few()

```


#### Conclusion: Exploring Net Permanent and Long-Term Migration by Year
- Although fairly level in 2016 and 2017, permanent and long-term migration to New Zealand for workers in the ANZSCO Major Occupation groups has increased throughout the 2010s.

## Exploring Net Permanent and Long-Term Migration by Quarter

```{r by_quarter, echo = F}

data %>% 
	group_by(quarter) %>% 
	summarise(., total = sum(total_occupations)) %>% 
	ggplot(., aes(x = quarter, y = total)) +
		geom_col(fill = "sienna3", width = .5) +
		labs(
			title = "Net Permanent and Long-Term Migration to New Zealand by Quarter",
			subtitle = "ANZSCO Major Occupations, 2010 - 2017",
			x = "Quarter", y = "All Major ANZSCO Occupations") +
		theme_few()
```


#### Conclusion: Exploring Net Permanent and Long-Term Migration by Quarter
- Few migrants travel to New Zealand April - June (likely because it is winter in the southern hemisphere), but migration is relatively steady throughout most of the year.

## Exploring Net Migration by Occupation

```{r by_occupation, echo = F}

data_spread <- data %>% 
	pivot_longer(.,
		cols = managers:labourers,
		names_to = "occupation",
		values_to = "occupation_count"
	) %>% 
	group_by(., occupation) %>% 
	summarise(., occupation_sum = sum(occupation_count)) %>% 
	ggplot(data = ., aes(y = occupation, x = occupation_sum)) +
		geom_col(fill = "sienna3") +
		labs(
			title = "Net Permanent and Long-Term Migration to New Zealand by Occupation",
			subtitle = "ANZSCO Major Occupations, 2010 - 2017",
			y = "Occupation", x = "All Major ANZSCO Occupations"
			) +
		theme_few() +
		scale_y_discrete(
			labels = c(
				"technicians__trades_workers" = "Technicians and Trades Workers",
				"sales_workers" = "Sales Workers",
				"professionals" = "Professionals",
				"managers" = "Managers",
				"machinery_operators__drivers" = "Machinery Operators and Drivers",
				"labourers" = "Laborers",
				"community__personal_service_workers" = "Community and Personal Service Workers",
				"clerical__administrative_workers" = "Clerical and Administrative Workers"
			)
		)

data_spread

```


#### Conclusion: Exploring Net Permanent and Long-Term Migration by Occupation
- Most permanent and long-term migrants are Professionals by far, while more Sales Workers and Machinery Operators and Drivers have departed New Zealand than have arrived.
